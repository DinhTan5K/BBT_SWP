@{
    ViewData["Title"] = "Login";
}

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Muli:wght@400;600;700&display=swap">

    <link rel="stylesheet" href="~/css/Account/login.css" />


<div class="login-form">
    <div class="background"></div>
    <div class="login-box">
        <div class="top">
            <img src="https://res.cloudinary.com/do48qpmut/image/upload/v1761645429/uploads/tdppvgyas8bhvfs7lton.png" alt="Logo">
            <div class="brand">
                <div class="title title-stack">
                    <span class="line1">ĐĂ<span class="hl">N</span>G</span>
                    <span class="line2"><span class="hl">N</span>HẬP</span>
                </div>
            </div>
        </div>
        <form asp-controller="Account" asp-action="Login" method="post" id="loginForm" onsubmit="return handleLoginSubmit(event)">
            <!-- Hiển thị lỗi từ Google OAuth -->
            @if (ViewBag.ErrorMessage != null)
            {
                <div class="alert alert-danger error-message" role="alert">
                    <i class="fa-solid fa-exclamation-triangle"></i>
                    <span>@ViewBag.ErrorMessage</span>
                </div>
            }
            <!-- Hiển thị lỗi tổng quát -->
            @if (!ViewData.ModelState.IsValid)
            {
                <div class="alert alert-danger error-message" role="alert">
                    <i class="fa-solid fa-exclamation-triangle"></i>
                    @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                    {
                        <span>@error.ErrorMessage</span>
                    }
                </div>
            }

            <div class="mb-3 input-group">
                <span class="input-group-text"><i class="fa-solid fa-user"></i></span>
                <input type="text" name="loginId" class="form-control" placeholder="Email hoặc Username" required />
            </div>
            <div class="mb-3 input-group">
                <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
                <input type="password" name="password" class="form-control" placeholder="Mật khẩu" required />
            </div>
            <button type="submit" class="btn-login btn-main w-100">Đăng nhập</button>
            <button type="button" class="btn-login btn-google w-100 mt-3" onclick="location.href='/login-google'">
                <i class="fa-brands fa-google"></i> Đăng nhập với Google
            </button>
        </form>



        <div class="extra-links">
            <p>Quên mật khẩu? <a asp-controller="Account" asp-action="ForgotPassword">Khôi phục</a></p>
            <p>Chưa có tài khoản? <a asp-controller="Account" asp-action="Register" class="alt">Đăng ký</a></p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const inputs = form.querySelectorAll('input[required]');
    
    // Add real-time validation
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            validateField(this);
        });
        
        input.addEventListener('input', function() {
            if (this.classList.contains('is-invalid')) {
                validateField(this);
            }
        });
    });
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        console.log('Form submit event triggered');
        let isValid = true;
        
        inputs.forEach(input => {
            if (!validateField(input)) {
                isValid = false;
            }
        });
        
        if (!isValid) {
            console.log('Form validation failed, preventing submit');
            e.preventDefault();
            return false;
        }
        
        console.log('Form validation passed, allowing submit');
        // Không preventDefault nếu validation pass
    });
    
    // Hàm xử lý submit với AJAX để kiểm tra response
    function handleLoginSubmit(event) {
        console.log('handleLoginSubmit called');
        const form = event.target;
        const formData = new FormData(form);
        
        // Thử submit bình thường trước
        // Nếu không hoạt động thì dùng AJAX
        return true; // Cho phép form submit bình thường
    }
    
    function validateField(input) {
        const inputGroup = input.closest('.input-group');
        const value = input.value.trim();
        
        if (input.hasAttribute('required') && !value) {
            inputGroup.classList.add('error');
            input.classList.add('is-invalid');
            return false;
        } else {
            inputGroup.classList.remove('error');
            input.classList.remove('is-invalid');
            return true;
        }
    }
});
</script>