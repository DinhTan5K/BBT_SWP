@using start.Models
@model EditEmployeeProfile
@{
    Layout = "~/Views/Shared/_EmployeeLayout.cshtml";
    ViewBag.ActiveMenu = "EditProfile";
    ViewData["Title"] = "Ch·ªânh s·ª≠a th√¥ng tin c√° nh√¢n";

    var emp = ViewData["Employee"] as Employee;
    var avatarUrl = !string.IsNullOrWhiteSpace(emp?.AvatarUrl)
        ? emp!.AvatarUrl
        : Url.Content("~/img/logo1.png");
}

@section Styles { <link rel="stylesheet" href="~/css/employee/editprofile.css" /> }

@if (TempData["ok"] != null){ <div class="ep-alert ep-success">@TempData["ok"]</div> }
@if (TempData["err"] != null){ <div class="ep-alert ep-error">@TempData["err"]</div> }

<nav class="tabs tabs--with-action">


  <!-- Kh·ªëi avatar: click ·∫£nh ƒë·ªÉ ch·ªçn file -->
  <form asp-controller="Employee" asp-action="UploadAvatar" method="post" enctype="multipart/form-data" class="ep-ava-wrap">
      @Html.AntiForgeryToken()
      <div class="ep-ava" id="avaClick">
        <img src="@avatarUrl" id="avatarPreview" alt="avatar">
        <div class="ep-ava-hint">ƒê·ªïi ·∫£nh</div>
      </div>
      <input type="file" name="avatar" id="avatarFile" accept="image/*" hidden />
      <button type="submit" class="btn btn-primary" id="btnUploadAvatar" style="display:none">T·∫£i l√™n</button>

  </form>
   <div class="tabs-left">
    <a class="tab active" href="#">Ch·ªânh s·ª≠a</a>
  </div>
</nav>

<div class="section">
  <form asp-controller="Employee" asp-action="Edit" method="post" class="ep-form">
    @Html.AntiForgeryToken()

    <h3 class="section-title">TH√îNG TIN C∆† B·∫¢N</h3>
    <div class="grid">
      <div class="field">
        <label>Ng√†y sinh</label>
        <input asp-for="DateOfBirth" type="date" />
        <span asp-validation-for="DateOfBirth" class="vld"></span>
      </div>
      <div class="field">
        <label>Gi·ªõi t√≠nh</label>
        <input asp-for="Gender" />
        <span asp-validation-for="Gender" class="vld"></span>
      </div>
      <div class="field">
        <label>Qu·ªëc t·ªãch</label>
        <input asp-for="Nationality" />
        <span asp-validation-for="Nationality" class="vld"></span>
      </div>
      <div class="field">
        <label>D√¢n t·ªôc</label>
        <input asp-for="Ethnicity" />
        <span asp-validation-for="Ethnicity" class="vld"></span>
      </div>
    </div>

    <h3 class="section-title">TH√îNG TIN LI√äN H·ªÜ</h3>
    <div class="grid">
      <div class="field">
        <label>ƒêi·ªán tho·∫°i di ƒë·ªông</label>
        <input asp-for="PhoneNumber" />
        <span asp-validation-for="PhoneNumber" class="vld"></span>
      </div>
      <div class="field">
        <label>Email c√° nh√¢n</label>
        <input asp-for="Email" type="email" />
        <span asp-validation-for="Email" class="vld"></span>
      </div>
      <div class="field">
        <label>SƒêT kh·∫©n c·∫•p 1</label>
        <input asp-for="EmergencyPhone1" />
        <span asp-validation-for="EmergencyPhone1" class="vld"></span>
      </div>
      <div class="field">
        <label>SƒêT kh·∫©n c·∫•p 2</label>
        <input asp-for="EmergencyPhone2" />
        <span asp-validation-for="EmergencyPhone2" class="vld"></span>
      </div>
    </div>

    <h3 class="section-title">ƒê·ªîI M·∫¨T KH·∫®U</h3>
<button type="button" class="btn btn-ghost btn-sm" id="btnTogglePwd">+ T√¥i mu·ªën ƒë·ªïi m·∫≠t kh·∫©u</button>

<div id="pwdBlock" style="display:none;margin-top:10px">
  <div class="grid">
    <div class="field">
      <label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
      <input asp-for="CurrentPassword" type="password" autocomplete="current-password" />
      <span asp-validation-for="CurrentPassword" class="vld"></span>
    </div>

    <div class="field">
      <label>M·∫≠t kh·∫©u m·ªõi</label>
      <input asp-for="NewPassword" type="password" autocomplete="new-password" />
      <span asp-validation-for="NewPassword" class="vld"></span>
    </div>

    <div class="field">
      <label>X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
      <input asp-for="ConfirmNewPassword" type="password" autocomplete="new-password" />
      <span asp-validation-for="ConfirmNewPassword" class="vld"></span>
    </div>
  </div>

</div>
<div asp-validation-summary="All" class="vld vld-sum"></div>

<div class="actions">
  <button type="submit" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
  <a asp-controller="Employee" asp-action="Profile" class="btn btn-ghost">Hu·ª∑</a>
</div>
</form>  <!-- üî• ƒê√≥ng form ·ªü ƒë√¢y, sau actions -->



@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script>
    // Toggle block ƒë·ªïi m·∫≠t kh·∫©u
    (function(){
      const btn = document.getElementById('btnTogglePwd');
      const blk = document.getElementById('pwdBlock');
      let open = false;
      btn?.addEventListener('click', function(){
        open = !open;
        blk.style.display = open ? 'block' : 'none';
        btn.textContent = open ? '- ·∫®n ph·∫ßn ƒë·ªïi m·∫≠t kh·∫©u' : '+ T√¥i mu·ªën ƒë·ªïi m·∫≠t kh·∫©u';
      });
    })();
    // Avatar: click ·∫£nh ho·∫∑c n√∫t ƒë·ªÉ ch·ªçn file, xem tr∆∞·ªõc v√† hi·ªán n√∫t t·∫£i l√™n
    (function(){
      const pickBtn = document.getElementById('btnPickAvatar');
      const imgWrap = document.getElementById('avaClick');
      const input = document.getElementById('avatarFile');
      const preview = document.getElementById('avatarPreview');
      const uploadBtn = document.getElementById('btnUploadAvatar');
      function choose(){ input?.click(); }
      pickBtn?.addEventListener('click', choose);
      imgWrap?.addEventListener('click', choose);
      input?.addEventListener('change', function(){
        if (this.files && this.files[0]) {
          const url = URL.createObjectURL(this.files[0]);
          preview.src = url;
          uploadBtn.style.display = 'inline-flex';
        }
      });
    })();
  </script>
}